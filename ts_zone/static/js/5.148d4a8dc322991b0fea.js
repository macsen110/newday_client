(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{37:function(e,t,n){"use strict";var a=function(){function e(e){this.method="GET",this.aysc=!0,this.sendData=null,this.cache=!0,"object"==typeof e&&Object.assign(this,e),this.url="https://www.macsen318.com"+this.url,this.send()}return e.prototype.send=function(){var e=this,t=new XMLHttpRequest;t.timeout=6e4,this.withCredentials&&(t.withCredentials=!0),t.withCredentials=!0,t.open(this.method,this.url,this.aysc),this.setHeader&&t.setRequestHeader("Content-Type",this.setHeader),this.cache||(t.setRequestHeader("Pragma","no-cache"),t.setRequestHeader("Cache-Control","no-cache")),t.onload=function(){if(4===t.readyState)if(200===t.status){var n;t.response&&(n=JSON.parse(t.response)),e.done(n)}else{var a=new Error("something went wrong");e.faild(a)}},t.onerror=function(t){e.faild(t)},t.send(this.sendData)},e}();t.a=a},52:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n(37),c=n(9),o=n(34);function r(e,t){switch(t.type){case c.g:return t.value;default:return e}}function i(e,t){switch(t.type){case c.f:return e.push(t.value),e.slice();case c.b:return t.value;case c.a:for(var n=void 0,a=0;a<e.length;a++)if(e[a]._id===t.value){n=a,e.splice(n,1);break}return e.slice();default:return e.slice()}}var m=n(18),l=a.useReducer,d=a.useEffect,u=a.useRef,h="00002";function p(e){var t,n=e.item;switch(e.category){case"image":t=a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width});break;case"video":t=a.createElement("video",{src:"//res.macsen318.com"+n.path,autoPlay:!0});break;case"note":t=n.url?a.createElement("div",null,a.createElement("p",null,n.content),a.createElement("p",null,a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width/2}))):a.createElement("p",null,n.content)}return a.createElement("li",{className:"item"},t)}function f(e){var t=e.commets,n=e.goodsid;return t.length?a.createElement("div",{className:"commets-container"},a.createElement("ul",{className:"commets-list"},t.map(function(t,s){return a.createElement(g,{dispatchCommets:e.dispatchCommets,goodsid:n,C_user:t.C_user,C_content:t.C_content,key:s,C_id:t._id})})),a.createElement(w,{goodsid:n,dispatchCommets:e.dispatchCommets})):a.createElement("div",{className:"commets-contain"},a.createElement(w,{goodsid:n,dispatchCommets:e.dispatchCommets}))}function g(e){var t=e.C_content,n=e.C_id,r=e.goodsid,i=e.C_user,l=function(t){(function(e){var t=e.C_id,n=e.goodsid;return new Promise(function(e){new s.a({url:"/api/comments/"+n+"/"+t,method:"DELETE",done:function(n){return 0===n.code&&e(t),n.code===h?Object(o.showPrompt)({msg:n.msg}):0!==n.code?Object(o.showPrompt)({msg:n.msg}):void 0}})})})({C_id:t.currentTarget.parentNode.dataset.id,goodsid:r}).then(function(t){return e.dispatchCommets({type:c.a,value:t})})};return a.createElement("li",{className:"item","data-id":n},a.createElement("span",{className:"con"},i+" : "+t),i===Object(m.a)()&&a.createElement("span",{className:"del",onClick:function(e){return l(e)}},"删除"))}function w(e){var t=u(null);return a.createElement("div",{className:"input-container"},a.createElement("textarea",{className:"ipt",ref:t}),a.createElement("p",null,a.createElement("button",{onClick:function(){var n,a,s,r,i=t.current,m=i?i.value:"";(n={goodsid:e.goodsid,content:m},a=n.goodsid,s=n.content,r=JSON.stringify({goodsid:a,comment:s}),fetch("https://www.macsen318.com/api/comments/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:r}).then(function(e){if(e.ok)return e.json()}).then(function(e){return e.code===h?Object(o.showPrompt)({msg:e.msg}):0!==e.code?Object(o.showPrompt)({msg:e.msg}):e})).then(function(t){return e.dispatchCommets({type:c.f,value:{C_content:t.commet,C_user:t.C_user,_id:t._id}})})},className:"btn"},"提交评论")))}t.default=function(e){var t=l(r,{}),n=t[0],o=t[1],u=l(i,[]),h=u[0],g=u[1],w=n.files||"";return d(function(){var t;(t=e.match.params.id,new Promise(function(e,n){new s.a({url:"/api/goods/detail/"+t,done:function(t){e(t)},faild:function(){var e=new Error("something wrong");n(e)}})})).then(function(e){o({type:c.g,value:e.detail}),g({type:c.b,value:e.commets})})},[]),n.id?a.createElement("div",{className:"app-detail-page"},a.createElement("p",{className:"page-title"},n.title),w.length>0&&a.createElement("ul",{className:"uri-list"},w.map(function(e,t){return a.createElement(p,{key:t,item:e,category:n.category})})),""!=n.content&&a.createElement("p",{className:"content"},n.content),a.createElement(f,{commets:h,goodsid:n.id,dispatchCommets:g}),n.user===Object(m.a)()&&a.createElement("button",{onClick:function(){var t;(t=e.match.params.id,fetch("https://www.macsen318.com/api/goods/delete/"+t,{method:"DELETE",credentials:"include"}).then(function(e){if(e.ok)return e.json()}).then(function(e){return e})).then(function(){return history.back()})},className:"icon-delete-page"},"x")):a.createElement("div",null,e.match.params.id)}}}]);