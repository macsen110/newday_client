(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{34:function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"e",function(){return c}),n.d(t,"c",function(){return r}),n.d(t,"g",function(){return s}),n.d(t,"f",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return l});var a="LOGIN",c="LOGOUT",r="LISTGOODS",s="SHOWGOOD",i="POSTCOMMET",o="DELETECOMMET",l="LISTCOMMETS"},35:function(e,t,n){"use strict";var a=function(){function e(e){this.method="GET",this.aysc=!0,this.sendData=null,this.cache=!0,"object"==typeof e&&Object.assign(this,e),this.url="https://www.macsen318.com"+this.url,this.send()}return e.prototype.send=function(){var e=this,t=new XMLHttpRequest;t.timeout=6e4,this.withCredentials&&(t.withCredentials=!0),t.withCredentials=!0,t.open(this.method,this.url,this.aysc),this.setHeader&&t.setRequestHeader("Content-Type",this.setHeader),this.cache||(t.setRequestHeader("Pragma","no-cache"),t.setRequestHeader("Cache-Control","no-cache")),t.onload=function(){if(4===t.readyState)if(200===t.status){var n;t.response&&(n=JSON.parse(t.response)),e.done(n)}else{var a=new Error("something went wrong");e.faild(a)}},t.onerror=function(t){e.faild(t)},t.send(this.sendData)},e}();t.a=a},43:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(35),r=n(34),s=n(31);function i(e,t){switch(t.type){case r.g:return t.value;default:return e}}function o(e,t){switch(t.type){case r.f:return e.push(t.value),e.slice();case r.b:return t.value;case r.a:for(var n=void 0,a=0;a<e.length;a++)if(e[a]._id===t.value){n=a,e.splice(n,1);break}return e.slice();default:return e.slice()}}var l=a.useReducer,u=a.useEffect,m=a.useRef,d="00002";function h(e){var t,n=e.item;switch(e.category){case"image":t=a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width});break;case"video":t=a.createElement("video",{src:"//res.macsen318.com"+n.path,autoPlay:!0});break;case"note":t=n.url?a.createElement("div",null,a.createElement("p",null,n.content),a.createElement("p",null,a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width/2}))):a.createElement("p",null,n.content)}return a.createElement("li",{className:"item"},t)}function f(e){var t=e.commets,n=e.goodsid;return t.length?a.createElement("div",{className:"commets-container"},a.createElement("ul",{className:"commets-list"},t.map(function(e,t){return a.createElement(p,{goodsid:n,C_content:e.C_content,key:t,C_id:e._id})})),a.createElement(E,{goodsid:n})):a.createElement("div",{className:"commets-contain"},a.createElement(E,{goodsid:n}))}function p(e){var t=e.C_content,n=e.C_id,r=e.goodsid,i=function(e){!function(e,t){new Promise(function(n,a){new c.a({url:"/api/comments/"+t+"/"+e,method:"DELETE",done:function(t){return 0===t.code&&n(+e),t.code===d?Object(s.showPrompt)({msg:t.msg}):0!==t.code?Object(s.showPrompt)({msg:t.msg}):void 0}})})}(e.target.parentNode.dataset.id,r)};return a.createElement("li",{className:"item","data-id":n},a.createElement("span",{className:"con"},"游客评论: "+t),a.createElement("span",{className:"del",onClick:function(e){return i(e)}},"删除"))}function E(e){var t=m(null);return a.createElement("div",{className:"input-container"},a.createElement("textarea",{className:"ipt",ref:t}),a.createElement("p",null,a.createElement("button",{onClick:function(){var n,a,c,r=t.current;n=e.goodsid,a=r?r.value:"",c=JSON.stringify({goodsid:n,content:a}),fetch("https://www.macsen318.com/api/comments/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:c}).then(function(e){if(e.ok)return e.json()}).then(function(e){return e.code===d?Object(s.showPrompt)({msg:e.msg}):0!==e.code?Object(s.showPrompt)({msg:e.msg}):void 0})},className:"btn"},"提交评论")))}t.default=function(e){var t=l(i,{}),n=t[0],s=t[1],m=l(o,[]),d=m[0],p=m[1],E=n.files||"";return u(function(){var t;(t=e.match.params.id,new Promise(function(e,n){new c.a({url:"/api/goods/detail/"+t,done:function(t){e(t)},faild:function(){var e=new Error("something wrong");n(e)}})})).then(function(e){s({type:r.g,value:e.detail}),p({type:r.b,value:e.commets})})},[]),n.id?a.createElement("div",{className:"app-detail-page"},a.createElement("p",{className:"page-title"},n.title),E.length>0&&a.createElement("ul",{className:"uri-list"},E.map(function(e,t){return a.createElement(h,{key:t,item:e,category:n.category})})),""!=n.content&&a.createElement("p",{className:"content"},n.content),a.createElement(f,{commets:d,goodsid:n.id})):a.createElement("div",null,e.match.params.id)}}}]);