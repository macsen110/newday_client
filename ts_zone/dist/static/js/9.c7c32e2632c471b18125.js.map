{"version":3,"sources":["webpack:///./script/build/components/goodsupload.tsx","webpack:///./script/build/utils/xhr.ts"],"names":["__webpack_require__","r","__webpack_exports__","d","goodsUpload","react__WEBPACK_IMPORTED_MODULE_0__","_utils_xhr__WEBPACK_IMPORTED_MODULE_1__","yao_m_ui__WEBPACK_IMPORTED_MODULE_2__","useState","useRef","unLoginCode","props","_a","type","setType","_b","uploadFiles","setUploadFiles","_c","typeDesc","formRef","id","className","method","action","onSubmit","e","preventDefault","form","current","title","value","Object","content","length","image","video","formdata","FormData","Promise","resolve","reject","cache","sendData","url","Date","parse","toString","done","callData","faild","error","then","obj","code","msg","cb","history","push","console","log","ref","name","placeholder","getDesc","onChange","target","defaultValue","filesArr","upFiles","files","i","multiple","accept","map","item","index","key","file","src","window","navigator","userAgent","indexOf","webkitURL","createObjectURL","URL","createObjectURLfun","readFile","size","xhr","opt","this","aysc","assign","send","prototype","_this","_xhr","XMLHttpRequest","timeout","withCredentials","open","setHeader","setRequestHeader","onload","readyState","status","sucData","response","JSON","Error","onerror"],"mappings":"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","file":"static/js/9.c7c32e2632c471b18125.js","sourcesContent":["import * as React from 'react';\nimport xhr from '../utils/xhr';\nimport { showPrompt } from 'yao-m-ui';\nconst {\n    useState,\n    useRef,\n    useEffect\n} = React\nconst unLoginCode = '00002';\nexport default function goodsUpload(props) {\n    const [type, setType] = useState('image');\n    const [uploadFiles, setUploadFiles] = useState([]);\n    const [typeDesc, setTypeDesc] = useState('');\n    const formRef = useRef<HTMLFormElement>(null);\n    const changeSelectType = (e) => {\n        setType(e.target.value)\n        setUploadFiles([])\n    }\n    const handleUploadFiles = (e) => {\n        var filesArr = [];\n        var upFiles: [] = e.target.files;\n        let i: any = 0;\n        for (i in upFiles) {\n            if (i >= 0) filesArr.push(upFiles[i]);\n        }\n        setUploadFiles(filesArr)\n    }\n    const readFile = (file: any) => {\n        var createObjectURLfun = function (file) {\n            if (window.navigator.userAgent.indexOf(\"Chrome\") >= 1 || window.navigator.userAgent.indexOf(\"Safari\") >= 1) {\n                // @ts-ignore\n                return window.webkitURL.createObjectURL(file);\n            } else {\n                return window.URL.createObjectURL(file);\n            }\n        };\n        switch (type) {\n            case 'image':\n                return <img src={createObjectURLfun(file)} />\n            case 'video':\n                return <img src=\"/imgs/video.jpg\" />\n            default:\n                return ''\n        }\n    }\n    const getDesc = (type: string) => {\n        var typeDesc: string;\n        switch (type) {\n            case 'video':\n                typeDesc = \"视频\";\n                break\n            case 'note':\n                typeDesc = \"笔记\"\n                break;\n            case 'image':\n            default:\n                typeDesc = \"图文\";\n                break\n        }\n        return typeDesc\n    }\n    const handleSubmit = (e: any) => {\n        e.preventDefault();\n        let form: any = formRef.current\n        let fetchDescMapType = {\n            \"image\": '图片',\n            \"video\": \"视频\"\n        }\n        if (!form) return;\n        if (!form.title.value) return showPrompt('标题不能为空');\n        if (!form.content.value) return showPrompt('内容不能为空');\n        if (type !== 'note' && uploadFiles.length === 0) return showPrompt(`请上传${fetchDescMapType[type]}`)\n        var url = '/api/goods/upload';\n        var formdata = new FormData(form);\n        var promise = new Promise(function (resolve, reject) {\n            new xhr({\n                cache: false,\n                sendData: formdata,\n                method: 'POST',\n                url: url + '?time=' + Date.parse(new Date().toString()),\n                done: function (callData) {\n                    resolve(callData)\n                },\n                faild: function (error) {\n                    reject(error)\n                }\n\n            })\n\n        })\n        promise.then(\n            (obj: any) => {\n                if (obj.code == 0) showPrompt({ msg: obj.msg, cb: () => props.history.push('/goods/list') });\n                else if (obj.code === unLoginCode) showPrompt({ msg: obj.msg, cb: () => props.history.push('/user/login') });\n            },\n            error => console.log(error)\n        )\n    }\n\n    return (\n        <div id=\"app_upload_page\" className=\"app-upload-page\">\n            <p className=\"page-title\">添加文章</p>\n            <form method=\"post\" action=\"/api/goods/upload\" className=\"form1\" onSubmit={handleSubmit} ref={formRef}>\n                <p className=\"pt20\">\n                    <input type=\"text\" name=\"title\" className=\"ipt\" placeholder=\"文章标题\" />\n                </p>\n                <div className=\"select-type\">\n                    发布{getDesc(type)}\n                    <i className=\"sign\"></i>\n                    <select name=\"category\" onChange={changeSelectType} defaultValue=\"image\">\n                        <option value=\"image\">图文</option>\n                        <option value=\"note\">笔记</option>\n                        <option value=\"video\">视频</option>\n                    </select>\n                </div>\n                {(type !== 'note') && (\n                    <div className=\"wrap-upload-ipt\">\n                        上传{typeDesc}\n                        <input type=\"file\" onChange={handleUploadFiles} multiple={true} accept={type + \"/*\"} name=\"pics\" className=\"ipt\" placeholder=\"file\" />\n                    </div>\n                )\n                }\n                {(uploadFiles.length > 0) && (<ul className=\"filesList\">\n                    {uploadFiles.map((item: any, index) => {\n                        return <li className=\"item\" key={index}>\n                            {readFile(item)}\n                            <em className=\"filename\">{item.name}</em>\n                            <em>{item.size}k</em>\n                        </li>\n                    })}\n                </ul>)\n                }\n                <p className=\"pt20\"><textarea className=\"ipt\" name=\"content\" placeholder=\"正文\" /></p>\n                <p className=\"pt20\">\n                    <input type=\"submit\" className=\"btn\" value=\"提交文章\" />\n                </p>\n            </form>\n        </div>)\n}\n\n","class xhr {\n\tmethod: string;\n\taysc: boolean;\n\tsendData: any;\n\tcache: boolean;\n\turl: string;\n\tsetHeader: any;\n\tfaild: Function;\n\twithCredentials: true;\n\tdone: Function;\n\tconstructor(opt: any) {\n\t\tthis.method = 'GET';\n\t\tthis.aysc = true;\n\t\tthis.sendData = null;\n\t\tthis.cache = true;\n\t\tif (typeof opt === 'object') {\n\t\t\tObject.assign(this, opt);\n\t\t}\n\t\t//@ts-ignore\n\t\tthis.url = perfixerURL + this.url\n\t\tthis.send();\n\n\t}\n\tsend() {\n\t\tvar _xhr = new XMLHttpRequest();\n\t\t_xhr.timeout = 60000;\n\t\tthis.withCredentials && (_xhr.withCredentials = true);\n\t\t_xhr.withCredentials = true\n\t\t_xhr.open(this.method, this.url, this.aysc);\n\n\t\tif (this.setHeader) {\n\t\t\t_xhr.setRequestHeader(\"Content-Type\", this.setHeader);\n\t\t}\n\t\tif (!this.cache) {\n\t\t\t_xhr.setRequestHeader(\"Pragma\", \"no-cache\");\n\t\t\t_xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n\t\t}\n\n\t\t_xhr.onload = () => {\n\t\t\tif (_xhr.readyState === 4) {\n\t\t\t\tif (_xhr.status === 200) {\n\t\t\t\t\tvar sucData;\n\t\t\t\t\tif (_xhr.response) {\n\t\t\t\t\t\tsucData = JSON.parse(_xhr.response);\n\t\t\t\t\t}\n\t\t\t\t\tthis.done(sucData);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar error = new Error(\"something went wrong\");\n\t\t\t\t\tthis.faild(error);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t_xhr.onerror = (error) => {\n\t\t\tthis.faild(error);\n\t\t}\n\t\t_xhr.send(this.sendData)\n\t}\n}\n\nexport default xhr;"],"sourceRoot":""}