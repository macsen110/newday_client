(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{35:function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"e",function(){return c}),n.d(t,"c",function(){return s}),n.d(t,"g",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return m});var a="LOGIN",c="LOGOUT",s="LISTGOODS",r="SHOWGOOD",o="POSTCOMMET",i="DELETECOMMET",m="LISTCOMMETS"},36:function(e,t,n){"use strict";var a=function(){function e(e){this.method="GET",this.aysc=!0,this.sendData=null,this.cache=!0,"object"==typeof e&&Object.assign(this,e),this.url="https://www.macsen318.com"+this.url,this.send()}return e.prototype.send=function(){var e=this,t=new XMLHttpRequest;t.timeout=6e4,this.withCredentials&&(t.withCredentials=!0),t.withCredentials=!0,t.open(this.method,this.url,this.aysc),this.setHeader&&t.setRequestHeader("Content-Type",this.setHeader),this.cache||(t.setRequestHeader("Pragma","no-cache"),t.setRequestHeader("Cache-Control","no-cache")),t.onload=function(){if(4===t.readyState)if(200===t.status){var n;t.response&&(n=JSON.parse(t.response)),e.done(n)}else{var a=new Error("something went wrong");e.faild(a)}},t.onerror=function(t){e.faild(t)},t.send(this.sendData)},e}();t.a=a},44:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(36),s=n(35),r=n(32);function o(e,t){switch(t.type){case s.g:return t.value;default:return e}}function i(e,t){switch(t.type){case s.f:return e.push(t.value),e.slice();case s.b:return t.value;case s.a:for(var n=void 0,a=0;a<e.length;a++)if(e[a]._id===t.value){n=a,e.splice(n,1);break}return e.slice();default:return e.slice()}}var m=n(17),u=a.useReducer,l=a.useEffect,d=a.useRef,h="00002";function p(e){var t,n=e.item;switch(e.category){case"image":t=a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width});break;case"video":t=a.createElement("video",{src:"//res.macsen318.com"+n.path,autoPlay:!0});break;case"note":t=n.url?a.createElement("div",null,a.createElement("p",null,n.content),a.createElement("p",null,a.createElement("img",{src:"//res.macsen318.com"+n.path,width:n.width/2}))):a.createElement("p",null,n.content)}return a.createElement("li",{className:"item"},t)}function f(e){var t=e.commets,n=e.goodsid;return t.length?a.createElement("div",{className:"commets-container"},a.createElement("ul",{className:"commets-list"},t.map(function(t,c){return a.createElement(E,{dispatchCommets:e.dispatchCommets,goodsid:n,C_user:t.C_user,C_content:t.C_content,key:c,C_id:t._id})})),a.createElement(g,{goodsid:n,dispatchCommets:e.dispatchCommets})):a.createElement("div",{className:"commets-contain"},a.createElement(g,{goodsid:n,dispatchCommets:e.dispatchCommets}))}function E(e){var t=e.C_content,n=e.C_id,o=e.goodsid,i=e.C_user,u=function(t){(function(e,t){return new Promise(function(n,a){new c.a({url:"/api/comments/"+t+"/"+e,method:"DELETE",done:function(t){return 0===t.code&&n(+e),t.code===h?Object(r.showPrompt)({msg:t.msg}):0!==t.code?Object(r.showPrompt)({msg:t.msg}):void 0}})})})(t.target.parentNode.dataset.id,o).then(function(t){return e.dispatchCommets({type:s.a,value:t})})};return a.createElement("li",{className:"item","data-id":n},a.createElement("span",{className:"con"},i+" : "+t),i===Object(m.a)()&&a.createElement("span",{className:"del",onClick:function(e){return u(e)}},"删除"))}function g(e){var t=d(null);return a.createElement("div",{className:"input-container"},a.createElement("textarea",{className:"ipt",ref:t}),a.createElement("p",null,a.createElement("button",{onClick:function(){var n,a,c,o=t.current,i=o?o.value:"";(n=e.goodsid,a=i,c=JSON.stringify({goodsid:n,comment:a}),fetch("https://www.macsen318.com/api/comments/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:c}).then(function(e){if(e.ok)return e.json()}).then(function(e){return e.code===h?Object(r.showPrompt)({msg:e.msg}):0!==e.code?Object(r.showPrompt)({msg:e.msg}):e})).then(function(t){return e.dispatchCommets({type:s.f,value:{C_content:t.commet,C_user:t.C_user,_id:t._id}})})},className:"btn"},"提交评论")))}t.default=function(e){var t=u(o,{}),n=t[0],r=t[1],d=u(i,[]),h=d[0],E=d[1],g=n.files||"";return l(function(){var t;(t=e.match.params.id,new Promise(function(e,n){new c.a({url:"/api/goods/detail/"+t,done:function(t){e(t)},faild:function(){var e=new Error("something wrong");n(e)}})})).then(function(e){r({type:s.g,value:e.detail}),E({type:s.b,value:e.commets})})},[]),n.id?a.createElement("div",{className:"app-detail-page"},a.createElement("p",{className:"page-title"},n.title),g.length>0&&a.createElement("ul",{className:"uri-list"},g.map(function(e,t){return a.createElement(p,{key:t,item:e,category:n.category})})),""!=n.content&&a.createElement("p",{className:"content"},n.content),a.createElement(f,{commets:h,goodsid:n.id,dispatchCommets:E}),n.user===Object(m.a)()&&a.createElement("button",{onClick:function(){var t;(t=e.match.params.id,fetch("https://www.macsen318.com/api/goods/delete/"+t,{method:"DELETE",credentials:"include"}).then(function(e){if(e.ok)return e.json()}).then(function(e){return e})).then(function(){return history.back()})},className:"icon-delete-page"},"x")):a.createElement("div",null,e.match.params.id)}}}]);