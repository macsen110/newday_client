{"remainingRequest":"/Users/macsen/Desktop/rltx-webpack/api/waybillService.js","dependencies":[{"path":"/Users/macsen/Desktop/rltx-webpack/api/waybillService.js","mtime":1511527701000},{"path":"/Users/macsen/Desktop/rltx-webpack/node_modules/_babel-loader@6.2.10@babel-loader/lib/index.js","mtime":1481808750000},{"path":"/Users/macsen/Desktop/rltx-webpack/node_modules/_cache-loader@1.2.0@cache-loader/dist/cjs.js","mtime":1510929699000}],"contextDependencies":[],"result":["/**\n * waybillService.js\n * Created by dsky on 17/7/5.\n */\n\nimport * as utils from './Utils';\nimport * as HTTP from './httpUtil';\n\nconst axios = require('axios');\nconst apiWayBillDomain = require('./ApiConst').apiWayBillDomain;\nconst code = {\n  success: 200\n};\naxios.defaults.withCredentials = true;\n\n// 获取列表数据\nfunction list(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/list`;\n  HTTP.get(apiUrl, paramObj, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取费用列表数据\nfunction settleList(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill_settle/list`;\n  HTTP.get(apiUrl, paramObj, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取列表操作\nfunction getAction(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/action/list`;\n  HTTP.post(apiUrl, { 'waybillCodeList': paramObj.join(',') }, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取订单车辆列表\nfunction getLogisticsTruckList(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/logistics/${paramObj.code}/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取头部搜索字段配置\nfunction getSearch(cb) {\n  const apiUrl = `${apiWayBillDomain}/search_render_info/waybill/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取费用列表头部搜索字段配置\nfunction getSettleSearch(cb) {\n  const apiUrl = `${apiWayBillDomain}/search_render_info/settle/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 删除数据\nfunction deleteList(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${paramObj.code}/delete`;\n  HTTP.post(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 删除费用列表数据\nfunction deleteSettleList(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill_settle/${paramObj.code}/delete`;\n  HTTP.post(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取列表显示字段\nfunction getColumn(cb) {\n  const apiUrl = `${apiWayBillDomain}/list_render_info/waybill/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取费用列表显示字段\nfunction getSettleColumn(cb) {\n  const apiUrl = `${apiWayBillDomain}/list_render_info/settle/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 添加\nfunction add(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/add`;\n  HTTP.post(apiUrl, paramObj, (response, err) => {\n    cb(response, err);\n  });\n}\n// 获取信息\nfunction get(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${paramObj.code}/info`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n//编辑\nfunction edit(code, paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/edit`;\n  HTTP.post(apiUrl, paramObj, (response, err) => {\n    cb(response, err);\n  });\n}\nfunction executeActionWithRecordCode(waybillCode, actionCode, actionRecordCode, actionParams, chargeParamList, cb) {\n  let params = {};\n  if (actionParams) {\n    Object.keys(actionParams).forEach((propertyName) => {\n      params[propertyName] = actionParams[propertyName];\n    });\n  }\n  if (chargeParamList && chargeParamList.length) {\n    chargeParamList.forEach((item) => {\n      Object.keys(item).forEach((key) => {\n        if (key in params) {\n          params[key] = `${params[key]},${item[key]}`;\n        } else {\n          params[key] = `${item[key]}`;\n        }\n      });\n    });\n  }\n  const apiUrl = `${apiWayBillDomain}/waybill/${waybillCode}/execute/${actionCode}/record/${actionRecordCode}`;\n  HTTP.post(apiUrl, params, (response, err) => {\n    cb(response, err);\n  });\n}\n/**\n * 执行业务动作\n * @param waybillCode 运单编码\n * @param actionCode 业务动作编码\n * @param actionParams 业务动作参数\n * @param chargeParamList 费用记录参数\n * @param cb 回调函数（响应，错误）\n */\nfunction executeAction(waybillCode, actionCode, actionParams, chargeParamList, cb) {\n  let params = {};\n  if (actionParams) {\n    Object.keys(actionParams).forEach((propertyName) => {\n      params[propertyName] = actionParams[propertyName];\n    });\n  }\n  if (chargeParamList && chargeParamList.length) {\n    chargeParamList.forEach((item) => {\n      Object.keys(item).forEach((key) => {\n        if (key in params) {\n          params[key] = `${params[key]},${item[key]}`;\n        } else {\n          params[key] = `${item[key]}`;\n        }\n      });\n    });\n  }\n  const apiUrl = `${apiWayBillDomain}/waybill/${waybillCode}/execute/${actionCode}`;\n  HTTP.post(apiUrl, params, (response, err) => {\n    cb(response, err);\n  });\n}\n\nfunction addAction(paramObj, tableList, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${paramObj.code}/execute/${paramObj.actionCode}`;\n  HTTP.post(apiUrl, { 'params': paramObj, 'chargeRecordList': tableList }, (response, err) => {\n    cb(response, err);\n  });\n}\nfunction getChargeDefine(code, cb) {\n  //GET /waybill/{code}/accounting/charge/define/list\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/accounting/charge/define/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\nfunction getCharge(code, action, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/accounting/charge/record/list?actionCode=${action}`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\nfunction getActionRecord(code, actionCode, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/action/record/list?actionCode=${actionCode}`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\nfunction getActionRecordWithParams(code, paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/action/record/list`;\n  HTTP.get(apiUrl, paramObj, (res, err) => {\n    cb(res, err);\n  });\n}\nfunction deleteActionRecord(code, actionCode, actionRecordCode, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/del/${actionCode}/record/${actionRecordCode}`;\n  HTTP.post(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n// 运单结算费用记录\nfunction getSettleList(code, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/accounting/charge/record/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n// 运单行车记录\nfunction getDriverList(code, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/driving/record/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\nfunction addSettle(settle, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/update/settle/info`;\n  HTTP.post(apiUrl, settle, (response, err) => {\n    cb(response, err);\n  });\n}\nfunction editSettle(code, settle, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/update/settle/info`;\n  settle.code = code;\n  HTTP.post(apiUrl, settle, (response, err) => {\n    cb(response, err);\n  });\n}\nfunction addDriver(code, settle, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/update/driving/record`;\n  let obj = {};\n  settle.forEach((value) => {\n    Object.keys(value).forEach((key) => {\n      if (key in obj) {\n        obj[key] += ',' + value[key];\n      } else {\n        obj[key] = value[key];\n      }\n    });\n  });\n  obj.code = code;\n  HTTP.post(apiUrl, obj, (response, err) => {\n    cb(response, err);\n  });\n}\nfunction addRecord(code, settle, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/update/accounting/charge/record`;\n  let obj = {},\n    settleData = [];\n  settle.forEach(val => {\n    if (val.chargeAmounts) {\n      settleData.push(val);\n    }\n  });\n  if (settleData.length) {\n    settleData.forEach((value) => {\n      Object.keys(value).forEach((key) => {\n        if (value[key] instanceof Array && value[key].length > 1) {\n          value[key] = value[key].join(':');\n        }\n        if (key in obj) {\n          obj[key] += ',' + value[key];\n        } else {\n          obj[key] = value[key];\n        }\n      });\n    });\n  }\n  HTTP.post(apiUrl, obj, (response, err) => {\n    cb(response, err);\n  });\n}\n// 运单业务动作操作记录列表\nfunction getSettleAction(code, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/action/record/list`;\n  HTTP.get(apiUrl, {}, (res, err) => {\n    cb(res, err);\n  });\n}\n\n// 获取运费总金额\nfunction getTotalAmount(code, model, record, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${code}/calculate`;\n  let obj = {},\n    recordData = [];\n  if (record && model) {\n    Object.keys(model).forEach((key) => {\n      if (key) {\n        // console.log('key: ', key);\n        obj[key] = model[key];\n      }\n    });\n    record.forEach(val => {\n      if (!isNaN(val.chargeAmounts)) {\n        recordData.push(val);\n      }\n    });\n    if (recordData.length) {\n      recordData.forEach((value) => {\n        Object.keys(value).forEach((key) => {\n          if (key in obj) {\n            obj[key] += ',' + value[key];\n          } else {\n            obj[key] = value[key];\n          }\n        });\n      });\n    }\n  }\n  HTTP.post(apiUrl, obj, (response, err) => {\n    cb(response, err);\n  });\n}\n\nfunction saveSettle(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/waybill/${paramObj.code}/settle`;\n  HTTP.post(apiUrl, paramObj, (response, err) => {\n    cb(response, err);\n  });\n}\n\n/**\n * export\n * @param callback\n */\nfunction exportCsv(paramObj, callback) {\n  const apiUrl = `${apiWayBillDomain}/export/waybill`;\n  HTTP.get(apiUrl, paramObj, (success, error) => {\n    callback(success, error);\n  });\n}\n\n/**\n * 下载错误数据的CSV文件\n */\nfunction downloadErrorData(paramObj, callback) {\n  const apiUrl = `${apiWayBillDomain}/generator/waybill`;\n  HTTP.post(apiUrl, paramObj, (success, error) => {\n    callback(success, error);\n  });\n}\n\n/**\n * 下载CSV模板\n */\nfunction downloadTemplate(paramObj, callback) {\n  const apiUrl = `${apiWayBillDomain}/download/template/waybill`;\n  HTTP.get(apiUrl, paramObj, (success, error) => {\n    callback(success, error);\n  });\n}\n\n/**\n * 运单上报\n * @param paramObj\n * @param cb\n */\nfunction waybillReport(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/report`;\n  HTTP.post(apiUrl, paramObj, (response, err) => {\n    cb(response, err);\n  });\n}\n\n/**\n * 校验车牌\n * @param paramObj\n * @param cb\n */\nfunction validateTruckLicenseNo(paramObj, cb) {\n  const apiUrl = `${apiWayBillDomain}/validateTruckLicenseNo`;\n  HTTP.post(apiUrl, paramObj, (response, err) => {\n    cb(response, err);\n  });\n}\n\n// 获取图片url\nfunction getImgUrl(resourceCode, callback) {\n  const apiUrl = `${apiWayBillDomain}/fw/image/${resourceCode}/get`,\n    paramObj = {\n      resourceCode\n    };\n  HTTP.get(apiUrl, paramObj, (success, error) => {\n    callback(success, error);\n  });\n}\n\nexport { executeAction, executeActionWithRecordCode, list, settleList, getAction, getActionRecord, getActionRecordWithParams,\n  getSearch, getSettleSearch, deleteList, deleteSettleList, getColumn, getSettleColumn, add, edit, get, addAction,\n  getCharge, getChargeDefine, getSettleList, addSettle, editSettle, getSettleAction, getDriverList, addDriver, addRecord, getTotalAmount,\n  saveSettle, exportCsv, downloadErrorData, downloadTemplate, waybillReport, validateTruckLicenseNo, getLogisticsTruckList,\n  getImgUrl, deleteActionRecord };\n",null]}