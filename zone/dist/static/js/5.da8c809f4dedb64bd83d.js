webpackJsonp([5],{137:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this.method="GET",this.aysc=!0,this.sendData=null,this.cache=!0,"object"===(void 0===e?"undefined":o(e))&&Object.assign(this,e),this.url="https://www.macsen318.com"+this.url,this.send()}return s(t,[{key:"send",value:function(){var t=new XMLHttpRequest;t.timeout=6e4,this.withCredentials&&(t.withCredentials=!0),t.withCredentials=!0,t.open(this.method,this.url,this.aysc),this.setHeader&&t.setRequestHeader("Content-Type",this.setHeader),this.cache||(t.setRequestHeader("Pragma","no-cache"),t.setRequestHeader("Cache-Control","no-cache")),t.onload=function(){if(4===t.readyState)if(200===t.status){var e;t.response&&(e=JSON.parse(t.response)),this.done(e)}else{var n=new Error("something went wrong");this.faild(n)}}.bind(this),t.onerror=function(t){this.faild(t)}.bind(this),t.send(this.sendData)}},{key:"done",value:function(t){}},{key:"faild",value:function(){}}]),t}();e.a=a},138:function(t,e,n){var i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(a,r){"object"===s(e)?t.exports=r():(i=r,void 0!==(o="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=o))}(0,function(){function t(t){if(t&&"object"==(void 0===t?"undefined":s(t)))for(var e in t)this[e]=t[e];this.tabNavContainer=this.tabNavContainer||document.querySelector(".tab-nav-container"),this.tabConContainer=this.tabConContainer||document.querySelector(".tab-con-container"),this.tabNavContainer&&(this.tabNavItems=this.tabNavItems||this.tabNavContainer.children),this.tabConContainer&&(this.tabConItems=this.tabConItems||this.tabConContainer.children),this.curIdex=this.curIdex||0,this.init()}function e(t){return this.title=null,this.content=null,this.foot=null,this.canMaskClose=!0,this.className="",this.type="dialog",this.container=document.createElement("div"),this.isMask=!0,this.config(t),this.mask=this.isMask?'<div class="dialog-mask-bg"></div>':"",this.open(),this}function n(t,e){var n="ontouchstart"in window;if(!t)return null;this.element=t,this.parentEle=e.parentEle||this.element,this.child=t.children[0],this.length=t.children.length,this.focusIndex=e.focusIndex||0,this.index=e.index||0,this.speed=e.speed||300,this.offset=e.offset||0,this.limitBorder=e.limitBorder||!1,this.showNum=e.showNum||this.length,this.deltaX=0,this.deltaY=0,this.callback=e.callback||function(){},this.touchMoveCb=e.touchMoveCb||function(){},this.hasMoved=!1,this.orientation=e.orientation||1,this.distance=e.distance,this.parentEle.addEventListener&&(this.parentEle.addEventListener(n?"touchstart":"mousedown",this,!1),this.element.addEventListener("webkitTransitionEnd",this,!1),this.element.addEventListener("transitionend",this,!1)),1==this.orientation?(this.childWidth=e.childWidth||this.child.clientWidth,this.parentWidth=e.parentWidth||this.childWidth*this.length):(this.childHeight=e.childHeight||this.child.clientHeight,this.parentHeight=e.parentHeight||this.childHeight*this.length),this.init()}function i(t){"object"===(void 0===t?"undefined":s(t))&&Object.keys(t).forEach(function(e){this[e]=t[e]}.bind(this)),"string"!=typeof t&&"number"!=typeof t||(this.msg=t),this.init()}function o(t){"object"===(void 0===t?"undefined":s(t))&&Object.keys(t).forEach(function(e){this[e]=t[e]}.bind(this));return this.html=this.html||'<div class="mask"></div><div class="spinner"></div>',this}return t.prototype={constructor:t,init:function(){var t=this;t.change(this.curIdex),t.tabNavItems&&[].forEach.call(t.tabNavItems,function(e,n){e.addEventListener("click",function(){t.change(n)})})},change:function(t){var e=this;e.curIdex=t,e.tabNavItems?[].forEach.call(e.tabNavItems,function(n,i){i!==t?(n.classList.remove("on"),e.tabConItems[i].classList.remove("on")):(n.classList.add("on"),e.tabConItems[i].classList.add("on"))}):[].forEach.call(e.tabConItems,function(e,n){n!==t?e.classList.remove("on"):e.classList.add("on")}),e.callback&&e.callback(t)}},e.prototype={constructor:e,config:function(t){if("object"===(void 0===t?"undefined":s(t)))for(var e in t)this[e]=t[e];return this},handleEvent:function(t){var e=t.target,n=e.classList;return n.contains("dialog-mask-bg")?void(this.canMaskClose&&(this.maskAction?this.maskAction():this.close())):n.contains("btn-dialog-ok")?void this.afterOk():void((n.contains("btn-dialog-cancel")||n.contains("icon-dialog-cancel"))&&this.close())},open:function(){this.container.className="widget-dialog "+this.className,this.title=this.title?'<div class="title">'+this.title+"</div>":"",this.content=this.content?'<div class="content">'+this.content+"</div>":"",this.foot=this.foot?'<div class="foot">'+this.foot+"</div>":"",this.main=this.title+this.content+this.foot,this.container.innerHTML='<div class="main">'+this.main+"</div>"+this.mask;var t=document.body;t.appendChild(this.container),this.afterOpen(),this.container.addEventListener("click",this)},afterOpen:function(){},afterOk:function(){this.destory()},close:function(){this.afterClose(),this.destory()},afterClose:function(){},destory:function(){var t=document.body;this.container&&(t.removeChild(this.container),this.container=null)}},n.prototype={constructor:n,init:function(){var t=this;[].forEach.call(t.element.children,function(e){1==t.orientation?e.style.width=t.childWidth+"px":e.style.height=t.childHeight+"px"}),1==t.orientation?t.element.style.width=t.parentWidth+"px":t.element.style.height=t.parentHeight+"px",1==t.orientation&&(t.element.style.MozTransform=t.element.style.webkitTransform="translate3d("+-(t.index-t.focusIndex)*t.childWidth+"px,0,0)"),2==t.orientation&&(t.element.style.MozTransform=t.element.style.webkitTransform="translate3d(0,"+-(t.index-t.focusIndex)*t.childHeight+"px,0)"),t.move(t.index)},handleEvent:function(t){var e=this;switch(t.type){case"mousedown":e.element.addEventListener("mousemove",e,!1),e.element.addEventListener("mouseup",e,!1),e.element.addEventListener("mouseout",e,!1),e.onTouchStart(t);break;case"mousemove":e.onTouchMove(t);break;case"mouseup":case"mouseout":e.element.removeEventListener("mousemove",e,!1),e.element.removeEventListener("mouseup",e,!1),e.element.removeEventListener("mouseout",e,!1),e.onTouchEnd(t);break;case"touchstart":e.parentEle.addEventListener("touchmove",e,!1),e.parentEle.addEventListener("touchend",e,!1),e.onTouchStart(t);break;case"touchmove":e.onTouchMove(t);break;case"touchend":e.parentEle.removeEventListener("touchmove",e,!1),e.parentEle.removeEventListener("touchend",e,!1),e.onTouchEnd(t);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":e.transitionEnd(t)}},onTouchStart:function(t){var e=this;e.start={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},e.element.style.webkitTransition="-webkit-transform 0ms"},onTouchMove:function(t){var e=this;t.touches.length>1||t.scale&&1!==t.scale||(e.deltaX=t.touches[0].pageX-e.start.pageX,e.deltaY=t.touches[0].pageY-e.start.pageY,1==e.orientation&&Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(t.preventDefault(),e.hasMoved||e.touchMoveCb&&e.touchMoveCb(e.index),e.element.style.MozTransform=e.element.style.webkitTransform="translate3d("+(e.deltaX-(e.index-e.focusIndex)*e.childWidth)+"px,0,0)"),2==e.orientation&&Math.abs(e.deltaY)>Math.abs(e.deltaX)&&(t.preventDefault(),e.hasMoved||e.touchMoveCb&&e.touchMoveCb(e.index),e.element.style.MozTransform=e.element.style.webkitTransform="translate3d(0,"+(e.deltaY-(e.index-e.focusIndex)*e.childHeight)+"px,0)"),e.hasMoved=!0)},onTouchEnd:function(t){var e=this;if(e.hasMoved||(1==e.orientation&&(e.deltaX=0),2==e.orientation&&(e.deltaY=0)),e.hasMoved=!1,1==e.orientation){var n,i=e.childWidth;if(e.distance){var o=e.deltaX-parseInt(e.deltaX/i)*i;n=o>0?e.index-(parseInt(e.deltaX/i)+(o-e.distance>0?1:0)):e.index-(parseInt(e.deltaX/i)+(Math.abs(o)-e.distance>0?-1:0))}else n=e.index-Math.round(e.deltaX/i)}if(2==e.orientation){var n,s=e.childHeight;if(e.distance){var o=e.deltaY-parseInt(e.deltaY/s)*s;n=o>0?e.index-(parseInt(e.deltaY/s)+(o-e.distance>0?1:0)):e.index-(parseInt(e.deltaY/s)+(Math.abs(o)-e.distance>0?-1:0))}else n=e.index-Math.round(e.deltaY/s)}if(n=e.limitIndex(n),e.autoMove(n),e.callback){e.index,e.offset;e.callback(e.index)}},transitionEnd:function(t){},autoMove:function(t){var e=this,n=this.element.style;n.webkitTransition="-webkit-transform "+e.speed+"ms",1==e.orientation&&(n.MozTransform=n.webkitTransform="translate3d("+-t*e.childWidth+"px,0,0)"),2==e.orientation&&(n.MozTransform=n.webkitTransform="translate3d(0,"+-t*e.childHeight+"px,0)"),e.index=t+e.focusIndex},move:function(t){var e=this;t-=e.offset,t=e.limitIndex(t);var n=this.element.style;n.webkitTransition="-webkit-transform "+e.speed+"ms",1==e.orientation&&(n.MozTransform=n.webkitTransform="translate3d("+-t*e.childWidth+"px,0,0)"),2==e.orientation&&(n.MozTransform=n.webkitTransform="translate3d(0,"+-t*e.childHeight+"px,0)"),e.index=t+e.focusIndex,e.callback&&e.callback(e.index)},limitIndex:function(t){var e=this;return e.limitBorder?t<0?t=0:t>e.length-e.showNum+e.focusIndex&&(t=e.length-(e.showNum-e.focusIndex)):t<-e.offset?t=-e.offset:t>e.length-1-e.offset&&(t=e.length-1-e.offset),t-e.focusIndex}},i.prototype={constructor:i,init:function(){this._container=document.querySelector(".widget-prompt"),this._container&&this.destory(),this.open()},open:function(){this._container=document.createElement("div"),this._container.className=this.className?this.className+" widget-prompt":"widget-prompt",this._container.innerHTML=this.msg,document.body.appendChild(this._container),this.promptTimer=setTimeout(function(){this.destory(),this.cb&&this.cb()}.bind(this),3e3)},destory:function(){this._container.parentNode.removeChild(this._container),this._container=null}},o.prototype={constructor:o,start:function(){this._container||(this._container=document.createElement("div"),this._container.innerHTML=this.html,this._container.className=this.className?this.className+" widget-loading":"widget-loading",document.body.appendChild(this._container)),this._container.style.display="block"},end:function(){this._container&&(this._container.style.display="none")}},{TabWidget:function(e){return new t(e)},Dialog:function(t){return new e(t)},easyMove:function(t,e){return new n(t,e)},showPrompt:function(t){return new i(t)},Loading:function(t){return new o(t)}}})},46:function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){return{showGood:t.showGood,commets:t.commets,initData:t.initData}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),c=n.n(r),l=n(137),h=(n(20),n(42)),d=n(6),u=n(138),m=(n.n(u),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),f=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.submitComment=n.submitComment.bind(n),n.deleteGoods=n.deleteGoods.bind(n),n}return s(e,t),m(e,[{key:"componentDidMount",value:function(){var t=this,e=this;new Promise(function(t,n){new l.a({url:"/api/goods/detail/"+e.props.match.params.id,done:function(e){t(e)},faild:function(){var t=new Error("something wrong");n(t)}})}).then(function(e){t.props.showGoodAction(e.detail),t.props.listCommetsAction(e.commets)},function(t){return console.log(t)})}},{key:"render",value:function(){var t=this,e=this.props.showGood,n=this.props.commets;if(e){var i=e.files;return c.a.createElement("div",{className:"app-detail-page"},c.a.createElement("p",{className:"page-title"},e.title),i.length>0&&c.a.createElement("ul",{className:"uri-list"},i.map(function(t,n){return c.a.createElement(p,{key:n,item:t,category:e.category})})),""!=e.content&&c.a.createElement("p",{className:"content"},e.content),n.length?c.a.createElement("div",{className:"comments-container"},c.a.createElement("p",{className:"comments-title"},"评论"),c.a.createElement("ul",{className:"list"},n.map(function(n,i){return c.a.createElement(v,{history:t.props.history,user:t.props.initData.user,author:e.user,C_user:n.C_user,deleteCommetAction:t.props.deleteCommetAction,key:i,item:n})}))):"",c.a.createElement("div",{ref:"wrapComment"},c.a.createElement("textarea",{className:"ipt"}),c.a.createElement("p",null,c.a.createElement("button",{onClick:this.submitComment,className:"btn"},"提交评论"))),this.props.initData.user===e.user&&c.a.createElement("button",{onClick:this.deleteGoods,className:"icon-delete-page"},"x"))}return c.a.createElement("div",null,this.props.match.params.id)}},{key:"deleteGoods",value:function(){var t=this;fetch("https://www.macsen318.com/api/goods/delete/"+t.props.match.params.id,{method:"DELETE",credentials:"include"}).then(function(t){if(t.ok)return t.json()}).then(function(e){0==e.code&&t.props.history.push("/goods/list")})}},{key:"submitComment",value:function(){var t=this,e=this.refs.wrapComment,n=e.querySelector("textarea"),i=this,o=JSON.stringify({goodsid:i.props.match.params.id,comment:n.value.trim()});fetch("https://www.macsen318.com/api/comments/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:o}).then(function(t){if(t.ok)return t.json()}).then(function(e){return"00002"===e.code?Object(u.showPrompt)({msg:e.msg,cb:function(){return t.props.history.push("/user/login")}}):0!==e.code?Object(u.showPrompt)({msg:e.msg}):(t.props.postCommetAction({C_content:e.commet,_id:e._id,C_user:e.C_user}),void(n.value=""))})}}]),e}(r.Component),p=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),m(e,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var t,e=this.props.item,n=this.props.category;switch(n){case"image":t=c.a.createElement("img",{src:"//res.macsen318.com"+e.path,width:e.width});break;case"video":t=c.a.createElement("video",{src:"//res.macsen318.com"+e.path,controls:"controls",autoPlay:!0});break;case"note":t=e.url?c.a.createElement("div",null,c.a.createElement("p",null,e.content),c.a.createElement("p",null,c.a.createElement("img",{src:"//res.macsen318.com"+e.path,width:e.width/2}))):c.a.createElement("p",null,e.content)}return c.a.createElement("li",{className:"item"},t)}}]),e}(c.a.Component),v=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),m(e,[{key:"delCommet",value:function(t){var e=this,n=this,i=t.target.parentNode,o=i.dataset.id;i.firstElementChild.innerHTML;new l.a({url:"/api/comments/"+o,method:"DELETE",done:function(t){return 0===t.code&&n.props.deleteCommetAction(+o),"00002"===t.code?Object(u.showPrompt)({msg:t.msg,cb:function(){return e.props.history.push("/user/login")}}):0!==t.code?Object(u.showPrompt)({msg:t.msg}):void 0}})}},{key:"render",value:function(){var t=this,e=this.props,n=this.props.item;return c.a.createElement("li",{className:"item","data-id":n._id},c.a.createElement("span",{className:"con"},e.C_user+"评论: "+n.C_content),(e.C_user==e.author||e.C_user==e.user)&&c.a.createElement("span",{className:"del",onClick:function(e){return t.delCommet(e)}},"删除"))}}]),e}(r.Component);e.default=Object(h.b)(a,{showGoodAction:d.n,listCommetsAction:d.k,postCommetAction:d.m,deleteCommetAction:d.h})(f)}});
//# sourceMappingURL=5.da8c809f4dedb64bd83d.js.map