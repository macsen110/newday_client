webpackJsonp([13],{40:function(t,e,a){var i,n;i=[a(0),a(2)],void 0!==(n=function(t,e){return{$rootDom:t("#page_container"),ui:{},ready:function(t){var e=a(63);APP.router.curPathName==t.pageName&&(APP.router.setRouter(t,this),this.show(e,t))},show:function(t,a){APP.tools.pageCount(),this.$rootDom.addClass("page-create-safety visibile"),this.$rootDom.append(t),0==APP.profileInfo.childState&&(a=JSON.parse(localStorage.babyInfoObj),a.pic=a.pictureInputStream),a.dateBorn=a.dateBorn.replace(/-/g,"."),1==APP.profileInfo.childState&&(a.pic=decodeURIComponent(a.pic)),1==APP.profileInfo.childState&&(a.sex=decodeURIComponent(a.sex)),a.name=APP.profileInfo.name;var i=this._getStarSign(parseInt(a.dateBorn.split(".")[1]),parseInt(a.dateBorn.split(".")[2]));this.chageWordsArr=["我是无敌的"+i+"宝宝","我是萌萌哒"+i+"宝宝",i+"宝宝最讨人喜欢",i+"宝宝都很有钱哦",i+"的宝宝最聪明呢","我是妈妈的小心肝","小王子"==a.sex||"兄弟连"==a.sex?" 我是建设银行哦":" 我是招商银行哦"," 我是妈妈的小棉袄"," 我是爸妈的小确幸"," 我是爸妈的小天使"," 我是爸妈的熊孩子"," 我是家里的大明星"," 我是爸妈的骄傲"],this.initSelectIndex=Math.floor(Math.random()*this.chageWordsArr.length),a.words=this.chageWordsArr[this.initSelectIndex].replace(/\s/g," ");var n=e("create_safety_template",a);this.$rootDom.prepend(n),this.bindUI(a),APP.selectBottomNav(-2)},bindUI:function(e){var a=this,i=a.$rootDom.find(".btn"),n=a.$rootDom.find(".change-words-btn"),r=a.$rootDom.find(".words");a.$rootDom.find("#baby").on("load",function(){a.babyWidth=this.width,a.babyHeight=this.height,t(this).hide()}),i.on("click",function(){a._createCanvas(e.sex,e.weight,e.dateBorn,e.pic),APP.tools.recordBehavior("/infanthospital/v1/superShare",{shareType:3,clickType:1})}),n.on("click",function(){var t=a.chageWordsArr.length,e=Math.floor(Math.random()*a.chageWordsArr.length);e=a._getValidIndex(a.initSelectIndex,e,t),a.initSelectIndex=e,r.html(a.chageWordsArr[e].replace(/\s/g," "))})},_getValidIndex:function(t,e,a){return t==e&&(e=e==a-1?e-1:e+1),e},_saveData:function(e,a,i,n){var r={request_context:{customerId:APP.profileInfo.customerId,appType:APP.openType,uid:APP.uid,sex:e,weight:a,dateBorn:i,pictureInputStream:"",tellSafyPictureStream:n,type:1==APP.profileInfo.childState?1:3},access_token:localStorage.getItem("token"),system:"mch"};t.ajax({url:APP.host.api+"/infanthospital/v1/childInfo",data:JSON.stringify(r),type:"post",contentType:"application/json",success:function(t){1==t.ret&&APP.router._gotoPage({pageName:"create_safety_share",pic:encodeURIComponent(t.data.safyPicturesPath)})}})},_createCanvas:function(t,e,a,i){function n(t,e,a){var i=document.createElement("canvas");i.width=640,i.height=1016;var n=i.getContext("2d"),o=n.createLinearGradient(0,0,640,1016),l=s.filter(function(t){return"baby"==t.name})[0],h=s.filter(function(t){return"avatar"==t.name})[0],c=s.filter(function(t){return"wrapBaby"==t.name})[0],d=(r.$rootDom.find(".pic")[0],s.filter(function(t){return"testTitle"==t.name})[0]),p=s.filter(function(t){return"logo"==t.name})[0];o.addColorStop(0,"#8753e7"),o.addColorStop(1,"#e05bc1"),n.fillStyle=o,n.fillRect(0,0,640,1016),n.drawImage(h.value,0,0,h.width,h.height,34,24,100,100),n.font="24px Arial",n.fillStyle="#fff";var f="辣妈 "+APP.profileInfo.name+"  向你扔来了一个小宝宝";n.fillText(f,188,86),n.font="40px fzzh",n.fillStyle="#fff";var g=a.replace(/-/g,".");n.fillText(g,188,166),n.font="32px fzzh";var u="wuli"+t+"在一妇婴平安诞生啦";n.fillText(u,76,216),n.font="32px fzzh",n.drawImage(l.value,0,0,l.width,l.height,126,290,400,400),n.drawImage(c.value,0,0,c.width,c.height,58,230,c.width,c.height),n.drawImage(d.value,0,0,d.width,d.height,150,36,d.width,d.height),n.drawImage(p.value,0,0,p.width,p.height,228,914,p.width,p.height),n.font="32px fzzh",n.fillStyle="#5e555a";var m=r.chageWordsArr[r.initSelectIndex];return n.fillText(m,164,720),n.fillStyle="小王子"==t||"兄弟连"==t?"#4181e2":"#e76f43",n.font="46px fzzh",n.fillText(e+"g",134,336),i.toDataURL("image/jpeg")}var r=this,o=[{name:"baby",value:i},{name:"avatar",value:"icon_select_pregnant_2"},{name:"wrapBaby",value:"bg_wrap_baby_"+("小王子"==t||"兄弟连"==t?"boy":"girl"),height:582,width:535},{name:"testTitle",value:"bg_canvas_title",width:464,height:78},{name:"logo",value:"logo_white",width:186,height:45}],s=[];o.forEach(function(i,l){var h=new Image;h.crossOrigin="Anonymous",h.src=0==l?i.value:"./images/"+i.value+".png",h.onload=function(){var l={name:i.name,value:this,height:i.height?i.height:this.height,width:i.width?i.width:this.width};if(s.push(l),s.length==o.length){var h=n(t,e,a);r._saveData(t,e,a,h)}}})},_getStarSign:function(t,e){var a;return(1==t&&e>=20||2==t&&e<=18)&&(a="水瓶座"),(2==t&&e>=19||3==t&&e<=20)&&(a="双鱼座"),(3==t&&e>=21||4==t&&e<=19)&&(a="白羊座"),(4==t&&e>=20||5==t&&e<=20)&&(a="金牛座"),(5==t&&e>=21||6==t&&e<=21)&&(a="双子座"),(6==t&&e>=22||7==t&&e<=22)&&(a="巨蟹座"),(7==t&&e>=23||8==t&&e<=22)&&(a="狮子座"),(8==t&&e>=23||9==t&&e<=22)&&(a="处女座"),(9==t&&e>=23||10==t&&e<=22)&&(a="天秤座"),(10==t&&e>=23||11==t&&e<=21)&&(a="天蝎座"),(11==t&&e>=22||12==t&&e<=21)&&(a="人马座"),(12==t&&e>=22||1==t&&e<=19)&&(a="摩羯座"),a},init:function(t){this.ready(t)},destroy:function(){this.$rootDom.removeClass("page-create-safety visibile"),this.$rootDom.html("")}}}.apply(e,i))&&(t.exports=n)},63:function(t,e){t.exports='<script id=create_safety_template type=text/template> <div class="wrap-title">\r\n        <span class="icon avatar"></span>\r\n        <p class="title">辣妈  {{name}} 向你扔来一个小宝宝</p>\r\n    </div>\r\n    <div class="wrap-time">\r\n        <p class="time">{{dateBorn}}</p>\r\n        <p class="desc">wuli{{sex}}在一妇婴平安诞生啦</p>\r\n    </div>\r\n    <div class="wrap-baby {{sex== \'小王子\' ? \'boy\' : \'girl\'}}">\r\n        <img class="baby" src="{{pic}}" alt="">\r\n        <div class="icon bg"></div>\r\n        <em class="weight">{{weight}}g</em>\r\n        <div class="words">{{words}}</div>\r\n        <button class="icon change-words-btn"></button>   \r\n    </div>\r\n    <button class="icon btn"></button> <\/script> '}});