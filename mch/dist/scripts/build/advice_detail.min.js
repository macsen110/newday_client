webpackJsonp([19],{

/***/ 33:
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/**
 * Created by knowthis on 16/6/29.
 */

!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0),__webpack_require__(2)], __WEBPACK_AMD_DEFINE_RESULT__ = (function($, template) {

    //init page
    var pageInitObj = {
        $rootDom: $('#page_container'),
        hasInput:0,
        ready: function (stateObj, data) {
            var self = this;
            var tplScript = __webpack_require__(56);
            if (APP.router.curPathName == stateObj.pageName) {
                APP.router.setRouter(stateObj, self);
                self.show(tplScript, data)
            }
        },
        show: function (tplScript, data) {
            var self = this;
            APP.tools.pageCount();
            self.$rootDom.html(tplScript);
            var html = template('advice_detail_template', data);
            self.$rootDom.prepend(html);
            self.bindUI(tplScript, data);

        },
        setPageInfo: function (type) {
            var obj = {
                "1": "产检报告相关",
                "2": "候诊相关",
                "3": "我的信息有误",
                "4": "建议新增功能",
                "5": "超级妈咪相关",
                "6": "其他"
            }
            APP.tools.setPageTitle(obj[type]);
        },
        bindUI: function (tplScript, data) {
            var self = this;
            self.setPageInfo(data.type);
            APP.selectBottomNav(-2);
            self.$rootDom.addClass('page-advice-detail visibile'); 
            self.ele = {}
            self.$eles = {
                $ipt: self.$rootDom.find('.advice-textarea'),
                $btn: self.$rootDom.find('.comm-btn'),
                $tags: self.$rootDom.find('.wrap-tags'),
                $mobile: self.$rootDom.find('.mobile-ipt') 
            };
            
            self.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                            window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
            self.cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame;
            self._listenId = self.requestAnimationFrame.call(null, self._listenBtnStatus.bind(self));

            self.$eles.$ipt.on('input', function () {
			    self._listenIpt($(this))
		    });
            self.$eles.$tags.find('.tag').on('click', function () {
                self._toggleTag($(this))
            })
            self.$eles.$btn.on('click', function () {
                self._submit(data.type)
            })
                         
        },
        _listenIpt: function ($this) {
            var val = $.trim($this.val());
			var curLen = val.length;
			var maxLen = $this.data('max');
			var $leftNum = $this.next().find('span');
            curLen = curLen > maxLen ? maxLen : curLen;
			if (curLen > maxLen) $this.val(val.slice(0, maxLen))			
			$leftNum.text(curLen)

        },
        _toggleTag: function ($this) {
            var self = this;
            if ($this.hasClass('select')) $this.removeClass('select');
            else {
                self.$eles.$tags.find('.tag').removeClass('select')
                $this.addClass('select');
            }
        },
        _submit: function (type) {
            var self = this;
            var mobile = $.trim(self.$eles.$mobile.val());
            if (mobile == '') {
                APP.ui.showPrompt('请填写电话号码!');
                self.$eles.$mobile.focus()
                return
            }
            if (!APP.tools.regExpObj.mobile.test(mobile)) {
                APP.ui.showPrompt('电话号码格式不正确!');
                self.$eles.$mobile.focus()
                return
            }
            var data = {
                request_context: {
                    customerId: APP.profileInfo.customerId,
                    uid : APP.uid,
                    appType: APP.openType,
                    changeMobile: mobile,
                    classify1: type,
                    tag: self.$eles.$tags.find('.select').data('index'),
                    feedBack: $.trim(self.$eles.$ipt.val())
                },
                access_token: localStorage.getItem('token'),
                system: 'mch'

            }
            $.ajax({
                url: APP.host.api + '/infanthospital/v1/customerFeedBack',
                data: JSON.stringify(data),
                type : 'post',
                contentType : 'application/json',
                success : function(response) {
                    if (response.ret == 1) {
                        self._saveAdvicemobile(data.changeMobile, data.uid)
                        APP.ui.showPrompt('提交成功',  function () {
                            APP.router.gotoPage({pageName: 'profile'});
                        });
                        return;
                    }
                    APP.ui.showPrompt(response.msg)
                }
            })

        },
        _saveAdvicemobile: function (mobile, uid) {
            localStorage.setItem('adviceMobileObj', JSON.stringify({uid: uid, mobile: mobile}))
        },
        init: function (stateObj) {
            var self = this;
            var mobile;
            var adviceMobileObj;
            if (localStorage.adviceMobileObj) adviceMobileObj = JSON.parse(localStorage.adviceMobileObj);
            if (adviceMobileObj) mobile = adviceMobileObj.uid == APP.uid ? adviceMobileObj.mobile : APP.profileInfo.mobile;
            var data = {
                type: stateObj.classify1,
                mobile: mobile
            }
            self.ready(stateObj, data);
            
        },
        _listenBtnStatus: function () {
            var self = this;
            if ($.trim(self.$eles.$ipt.val()) != '' || self.$eles.$tags.find('.select').length) self.$eles.$btn.removeAttr('disabled');
            else self.$eles.$btn.attr('disabled',true) 
            self._listenId = self.requestAnimationFrame.call(null, self._listenBtnStatus.bind(self));
        },
        destroy: function () {
            //如果有事件绑定的话, 解除事件绑定
            this.$rootDom.removeClass('page-advice-detail visibile');
            this.$rootDom.html('');
            this.cancelAnimationFrame.call(null, this._listenId)
        }
    };
    return pageInitObj;
}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));

/***/ }),

/***/ 56:
/***/ (function(module, exports) {

module.exports = "<script id=\"advice_detail_template\" type=\"text/html\">\n    <div class=\"mobile-container\"><i class=\"icon\"></i>联系方式\n        {{if mobile}}<i class=\"icon-sign-right\"></i>{{/if}}\n        <input type=\"tel\" value=\"{{mobile ? mobile : ''}}\" class=\"mobile-ipt\" placeholder=\"请输入手机号\">\n        \n    </div>\n    <div class=\"advice-main-input\">\n        <textarea class=\"advice-textarea\" data-max=\"500\" placeholder=\"请留下就诊卡号，所在院区及门诊类型(如:东院普通门诊),问题描述, 我们会在2个工作日内和您联系处理并帮助您处理.\"></textarea>\n        <div class=\"advice-num\"><span>0</span>/500</div>\n    </div>\n    {{if type == 1}}\n    <ul class=\"wrap-tags\">\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"1\">已有检查报告没有显示</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"2\">检查报告不是本人的报告</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"3\">检查项目显示有误</span>\n            <span class=\"tag\" data-index=\"4\">报告显示日期有误</span>\n        </li>\n    </ul>\n    {{/if}}\n    {{if type == 2}}\n    <ul class=\"wrap-tags\">\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"1\">候诊信息没有显示</span>\n            <span class=\"tag\" data-index=\"2\">检查楼层有误</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"3\">候诊信息不能更新</span>\n        </li>\n    </ul>\n    {{/if}}\n    {{if type == 3}}\n    <ul class=\"wrap-tags\">\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"1\">名字录入错误</span>\n             <span class=\"tag\" data-index=\"2\">手机号码错误</span>\n        </li>\n        <li class=\"item\">\n           <span class=\"tag\" data-index=\"3\">末次月经错误</span>\n           <span class=\"tag\" data-index=\"4\">预产期错误</span>\n        </li>\n    </ul>\n    {{/if}}\n    {{if type == 4}}\n    <ul class=\"wrap-tags\">\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"1\">门诊线上预约</span>\n            <span class=\"tag\" data-index=\"2\">建卡资料线上填写</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"3\">报告生成推送提醒</span>\n            <span class=\"tag\" data-index=\"4\">排队信息推送提醒</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"5\">报告详细解读</span>\n            <span class=\"tag\" data-index=\"6\">B超影像资料</span>\n        </li>\n    </ul>\n    {{/if}}\n    {{if type == 5}}\n    <ul class=\"wrap-tags\">\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"1\">个人信息错误</span>\n            <span class=\"tag\" data-index=\"2\">B超照片无法展示</span>\n        </li>\n        <li class=\"item\">\n            <span class=\"tag\" data-index=\"3\">购买遇到问题</span>\n        </li>\n    </ul>\n    {{/if}}\n    <div class=\"advice-button\">\n        <button type=\"button\" class=\"comm-btn\" disabled>提交</button>\n    </div>\n</script>";

/***/ })

});