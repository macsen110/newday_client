webpackJsonp([1],{

/***/ 54:
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/**
 * Created by liangyusen on 15/11/30.
 */
 !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0),__webpack_require__(3)], __WEBPACK_AMD_DEFINE_RESULT__ = (function($, template) {    
	//init page
	var pageInitObj = {
		$rootDom: $('#page_container'),
		isBindCard: false,
		ready: function (stateObj, data) {
			var self = this;
			var tplScript = __webpack_require__(76);
			if (APP.router.curPathName == stateObj.pageName) {
				APP.router.setRouter(stateObj, self);
				self.show(tplScript, data);
			}
		},
		show: function (tplScript, data) {
			var self = this;
			APP.tools.pageCount();
			self.$rootDom.html(tplScript);
			var html;
			if (data.isToday == 1) html = template('wait_unbind_card_template', data) 
			else html = self.isBindCard ? template('wait_bind_card_template', data) : template('wait_unbind_card_template', data);   
			self.$rootDom.prepend(html);
			APP.selectBottomNav(1);
			self.bindUI(); 
		},
		setPageInfo: function () {
			APP.tools.setPageTitle('我的候诊')
		},
		bindUI: function () {
			var self = this;
			self.setPageInfo();
			self.$rootDom.addClass('page-wait-doctor visibile');
			$('.unbind-card-container .widget-tip-box').on('click',function(){
				var hrefvalue = $(this).attr('data-href');
				setTimeout(function(){
					window.location.href = hrefvalue;
				},800)
			})
			if (self.isBindCard && !sessionStorage.getItem('queueIsToday')) self._startTimeCount();
		},
		init: function (stateObj) {
			var self = this;
			var profileInfo = APP.profileInfo;
			if (profileInfo.emStatus == 1) self.unbindCard(stateObj) 
			if (profileInfo.emStatus == 2) self.bindCard(stateObj);
		},
		bindCard: function (stateObj) {
			//this need to request bindCard ajax
			var self = this;
			self.isBindCard = true;
			var profileInfo = APP.profileInfo;
			if (sessionStorage.getItem('queueIsToday')) {
				var data = {
					isToday: 1
				}
				self.ready(stateObj, data);
				return;
			}
			var postData = {
				request_context: {
					uid: profileInfo.uid,
					customerId: profileInfo.customerId,
					appType : APP.openType
				},
				access_token: localStorage.getItem('token'),
				system: 'mch'
			}
			$.ajax({
				url: APP.host.api + '/infanthospital/v1/getQueueInfo',
				type: 'post',
				data: JSON.stringify(postData),
				contentType: 'application/json',
				success: function (res) {
					if (res.ret == 1) {
						res = self._todoResult(res.data);
						if (res.isToday == 1) {
							sessionStorage.setItem('queueIsToday', res.isToday)
						}
						self.ready(stateObj, res);
						return;
					}
					APP.router.endLoading();
					APP.ui.showPrompt(response.msg);
				},
				error: function () {
					APP.router.endLoading();
					APP.ui.showPrompt('网络错误,<br>请稍后重试')
				}
			})
			
		},
		unbindCard: function (stateObj) {
			var self = this;
			var unbindCardUrl = APP.openType  == 1 ? 'https://wxapi.shqmxx.com/WXOAuth/AuthReceivePage.aspx?customerId=77&applicationId=2b0ff89f27584e3ab81d44d060a4271e&goUrl=https://h5.shqmxx.com/Template/Resource.aspx?Pri=QM.CSFP.77.DIS.UserManage-Binding' : 'http://alipay.51mch.com/HTML/myCardList.html?userID='+encodeURIComponent(APP.uid);
			self.ready(stateObj, {uid: APP.uid,unbindCardUrl:unbindCardUrl});            
		},
		_todoResult: function (result) {
			var self = this;
			return result
		},
		_startTimeCount: function () {
		  var self = this;
		  self.timeCount = setInterval(function () {
			  APP.router.gotoPage({replace: 1, pageName: 'waiting_doctor'})
		  }, 10000)  
		},
		_endTimeCount: function () {
			var self = this;
			clearInterval(self.timeCount)
		},
		destroy: function () {
			//如果有事件绑定的话, 解除事件绑定
			this.$rootDom.html('');
			this.$rootDom.removeClass('visibile page-wait-doctor');
			this._endTimeCount();
		}
	}
	
	
	return pageInitObj;
}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))

/***/ }),

/***/ 76:
/***/ (function(module, exports) {

module.exports = "<script id=\"wait_unbind_card_template\" type=\"text/html\">\n    <div class=\"unbind-card-container\">\n        {{if !isToday}}\n        <a class=\"widget-tip-box\" href=\"javascript:void(0)\" data-href=\"{{unbindCardUrl}}\">\n            <p>绑定就诊卡，智能提醒，轻松候诊</p>\n            <i class=\"sign\"></i>\n        </a>\n        {{/if}}\n        <div class=\"wrap-list-test\">\n            \n            <ul class=\"list\">\n                <li class=\"item\">\n                    <p class=\"desc\"><span class=\"fr\"><i class=\"icon\"></i><em class=\"address\">门诊2楼抽血中心</em></span>验血</p>\n                </li>\n                <li class=\"item\">\n                    <p class=\"desc\"><span class=\"fr\"><i class=\"icon\"></i><em class=\"address\">门诊1楼B超</em></span>B超</p>\n                </li>\n                <li class=\"item\">\n                    <p class=\"desc\"><span class=\"fr\"><i class=\"icon\"></i><em class=\"address\">门诊1楼标本收集处</em></span>尿检</p>\n                </li>\n                <li class=\"item\">\n                    <p class=\"desc\"><span class=\"fr\"><i class=\"icon\"></i><em class=\"address\">门诊1楼产科A区</em></span>胎心</p>\n                </li>\n                <li class=\"item\">\n                    <p class=\"desc\"><span class=\"fr\"><i class=\"icon\"></i><em class=\"address\">门诊2楼心电图室</em></span>心电图</p>\n                </li>\n            </ul>\n        </div>\n    </div>\n</script>\n<script id=\"wait_bind_card_template\" type=\"text/html\">\n    <div class=\"bind-card-container\">\n        <div class=\"widget-head-avatar\">\n            <img class=\"avatar\" src=\"images/icon_avatar_2.png\" alt=\"avatar\">\n            <div class=\"content\">\n                <p>{{isToday ? '今日产检' : '下次产检'}}<em class=\"status\">已孕{{weekPregnant}}周</em></p>\n                <p>{{checkDate}} {{checkWeek}} {{checkTime}}</p>\n            </div>\n        </div>\n        {{if isToday }}\n        <div class=\"tip-container\">\n            <i class=\"icon\"></i>\n            已推荐候诊顺序，若有过号项请咨询护士台\n        </div>\n        <ul class=\"list\">\n            {{each queueList}}\n            {{if $value.id != 5 && $value.id !=6 }}\n            <li class=\"item type-{{$value.id}} status-{{$value.queueStatus}} {{$value.queueNumberCurrent == $value.queueNumberMine ? 'cur' : ''}}\">\n                <i class=\"icon\"></i>\n                <div class=\"content\">\n                    <p class=\"desc\"><em class=\"test-item-key\">检查项目</em><em class=\"icon icon-location\"></em></p>\n                    <p class=\"desc\">{{$value.name}}<span class=\"fr\">{{$value.departmentAddress}}</span></p>\n                    {{if $value.queueNumberMine != null}}\n                    \n                    <ul class=\"queue-list\">\n                            <li class=\"item\">\n                            <p>{{$value.queueNumberCurrent}}</p>\n                            <p>当前叫号</p>\n                        </li>\n                        <li class=\"item\">\n                            <p>{{$value.queueNumberMine}}</p>\n                            <p>我的诊号</p>\n                        </li>\n                        <li class=\"item\">\n                            {{if $value.queueWaitingNumber > 0}}\n                            <p>{{$value.queueWaitingNumber}}</p>\n                            <p>前面人数</p>\n                            {{/if}}\n                            {{if $value.queueWaitingNumber < 0}}<span>已过号</span> {{/if}}\n                            {{if $value.queueWaitingNumber == 0}}<span>已到号</span> {{/if}}\n                            <!--{{if $value.queueStatus == 4}}<p>已完成</p> {{/if}}-->\n                            <!--{{if $value.queueStatus == 5}}<p>已到期</p> {{/if}}-->\n\n\n                        </li>\n                    </ul>\n                    {{/if}}\n                </div>\n            </li>\n            {{/if}}\n            {{if $value.id == 5 || $value.id ==6}}\n            <li class=\"item type-{{$value.id}}\">\n                <i class=\"icon\"></i>\n                <div class=\"content\">\n                    <p class=\"desc\"><em class=\"test-item-key\">检查项目</em><strong>(现场排队)</strong><em class=\"icon icon-location\"></em></p>\n                    <p class=\"desc\">{{$value.name}}<span class=\"fr\">{{$value.departmentAddress}}</span></p>\n                </div>\n            </li>\n            {{/if}}\n            {{/each}}\n        </ul>\n        {{/if}}\n        {{if !isToday }}\n        <ul class=\"list\">\n            {{each queueList}}\n            <li class=\"item type-{{$value.id}} status-{{$value-queueStatus}}\">\n                <i class=\"icon\"></i>\n                <div class=\"content\">\n                    <p class=\"desc\"><em class=\"test-item-key\">检查项目</em>{{if $value.id == 5 || $value.id == 6}}<strong>(现场排队)</strong>{{/if}}<em class=\"icon icon-location\"></em></p>\n                    <p class=\"desc\">{{$value.name}}<span class=\"fr\">{{$value.departmentAddress}}</span></p>\n                    \n                </div>\n            </li>\n            {{/each}}\n        </ul>\n        {{/if}}\n    </div>\n</script>\n";

/***/ })

});