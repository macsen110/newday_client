webpackJsonp([11],{42:function(t,i,e){var a,o;a=[e(0),e(2),e(3)],void 0!==(o=function(t,i,a){return{$rootDom:t("#page_container"),ui:{},ready:function(t,i){var a=e(65);APP.router.curPathName==t.pageName&&(APP.router.setRouter(t,this),this.show(a,i))},show:function(t,e){if(APP.tools.pageCount(),this.$rootDom.html(t),0==APP.profileInfo.childState&&localStorage.babyInfoObj){if(this.imgData=1,e=JSON.parse(localStorage.babyInfoObj),e.dateBorn){var a=this._getSerializeDate(e.dateBorn);e.dateBornText=a[0]+"年"+a[1]+"月"+a[2]+"日"}e.babyPictures=e.pictureInputStream}var o=i("declare_safety_template",e);this.$rootDom.prepend(o),this.bindUI(),APP.selectBottomNav(-2)},bindUI:function(){var i=this;i.$rootDom.addClass("page-declare-safety visibile"),t("body").find(".logobg").css("visibility","hidden");i.$rootDom.find(".upload-avatar");t("input[type=file]").on("change",function(){var t=this.files;t.length&&(APP.router.startLoading(),i._renderFile(t))}),i.$rootDom.find(".gener-btn").on("click",function(t){t.preventDefault(),i._validData()}),2==APP.tools.platform()&&i.$rootDom.find(".birth").addClass("ios"),i._setPageInfo(),i._bindClipImg(),APP.tools.selectValueChange(i.$rootDom.find(".birth"),i._changeChildBirth.bind(i))},_bindClipImg:function(){function i(){try{var t,i,a=e.clip.originImgSizeObj.width/e.clip.overLayWidth>1?e.clip.originImgSizeObj.width/e.clip.overLayWidth:1,o=(-e.clip.$overLay.offset().top+e.clip.$img.offset().top)*a,n=e.clip.$img.offset().left*a,r=e.clip.originImgSizeObj.width,l=e.clip.originImgSizeObj.height,s=document.createElement("canvas");s.width=e.clip.originImgSizeObj.width>e.clip.overLayWidth?e.clip.originImgSizeObj.width:e.clip.overLayWidth,s.height=s.width;var c=s.getContext("2d");c.fillStyle="#ffffff",c.fillRect(0,0,s.width,s.height),r<e.clip.overLayWidth?(o>0?l=e.clip.overLayWidth-o>l?l:e.clip.overLayWidth-o:l-=Math.abs(o),n>0&&(r=e.clip.overLayWidth-n>r?r:r-(n-e.clip.overLayWidth)),n<0&&(r-=Math.abs(n))):(r<l?l=l-Math.abs(o)>r?r:l-Math.abs(o):o>0?l=r-Math.abs(o)>l?l:r-o:l+=o,r-=Math.abs(n)),t=n>0?n:0,i=o>0?o:0,n=n>0?0:-n,o=o>0?0:-o;var p=new Image;return p.src=e.clip.$img[0].src,s.getContext("2d").drawImage(p,n,o,r,l,t,i,r,l),s.toDataURL("image/png")}catch(t){alert(t)}}var e=this;e.clip={},e.clip.$clipContainer=e.$rootDom.find(".clip-image-container"),e.clip.$img=e.clip.$clipContainer.find(".clip-img"),e.clip.$overLay=e.clip.$clipContainer.find(".overlay"),e.clip.originImgSizeObj={};var a,o,n=e.clip.$clipContainer.find(".ok"),r=e.clip.$clipContainer.find(".cancel"),l=(t(".img-move")[0],{});e.clip.$img[0].addEventListener("touchstart",function(t){a=t.touches[0].pageX,o=t.touches[0].pageY,l.X=e.clip.$img.offset().left-e.clip.$clipContainer.width()/2,l.Y=e.clip.$img.offset().top-e.clip.$clipContainer.height()/2}),e.clip.$img[0].addEventListener("touchmove",function(t){t.preventDefault();var i=l.X+(t.touches[0].pageX-a),e=l.Y+(t.touches[0].pageY-o);this.style.MozTransform=this.style.webkitTransform="translate3d("+i+"px,"+e+"px,0)"}),n.on("click",function(t){e._previewImg(i()),e._resetClipImgStatus()}),r.on("click",function(){e._resetClipImgStatus()})},_resetClipImgStatus:function(){var t=this;t.clip.$clipContainer.hide(),t.clip.$img[0].removeAttribute("style"),t.clip.$img[0].src=""},_setPageInfo:function(){var i=this;t("body").addClass("bg-color-common"),APP.tools.setPageTitle("2"==i.origin?"怀孕日记":"报平安")},_validData:function(){var i=this,e=i.$rootDom.find("form")[0];if(!i.imgData)return void APP.ui.showPrompt("请选择一张图片上传");var a=e.sex;if(0==a.value)return void APP.ui.showPrompt("请选择婴儿性别");var o=e.birth;if(""==o.value)return void APP.ui.showPrompt("请选择婴儿生日");var n=e.weight,r=t.trim(n.value);if(""==r)return APP.ui.showPrompt("请输入婴儿体重"),void n.focus();if(4!=r.length||r<1e3)return APP.ui.showPrompt("请输入合法体重"),void n.focus();var l=2==i.origin?2:1;i._saveData(l,a.value,n.value,o.value,i.imgData)},_saveData:function(i,e,a,o,n){var r=this,l={customerId:APP.profileInfo.customerId,appType:APP.openType,uid:APP.uid,sex:e,weight:a,dateBorn:o,pictureInputStream:function(){return 0==APP.profileInfo.childState?r.$rootDom.find(".avatar-container .pic").attr("src"):r.isImgChange?n:""}(),tellSafyPictureStream:"",type:i};if(0==APP.profileInfo.childState)return localStorage.setItem("babyInfoObj",JSON.stringify(l)),void APP.router._gotoPage({pageName:"create_safety"});var s={request_context:l,access_token:localStorage.getItem("token"),system:"mch"};t.ajax({url:APP.host.api+"/infanthospital/v1/childInfo",data:JSON.stringify(s),type:"post",contentType:"application/json",success:function(t){if(1==t.ret)if(1==i){var n={pageName:"create_safety",sex:encodeURIComponent(e),weight:a,dateBorn:o,pic:encodeURIComponent(t.data.babyPicturesPath)};APP.router._gotoPage(n)}else APP.router._gotoPage({pageName:"pregnant_record",pregnantStatus:2})}})},_getSerializeDate:function(t){return t.split("-")},_changeChildBirth:function(t){var i=this,e=i.$rootDom.find(".child-val-label");if(t){var a=i._getSerializeDate(t);e.text(a[0]+"年"+a[1]+"月"+a[2]+"日")}},_renderFile:function(t){var i=this,e=t[0],a=new FileReader;a.onload=function(t){if(Math.floor(t.total/1024/1024)>=3)return APP.router.endLoading(),void APP.ui.showPrompt("图片过大, 请重新选择图片上传");i._clipImage(t.target.result)},a.readAsDataURL(e)},_previewImg:function(t){var i=this,e=i.$rootDom.find(".pic");i.$rootDom.find(".wrap-pic").addClass("active"),i.imgData=t,i.isImgChange=!0,e[0].src=t},_clipImage:function(t){var i=this;i.clip.$clipContainer.show(),i.clip.fullWidth=i.clip.$clipContainer.width(),i.clip.fullHeight=i.clip.$clipContainer.height(),i.clip.overLayWidth=i._getRectWidth(i.clip.fullWidth,i.clip.fullHeight),i.clip.$overLay.css({width:i.clip.overLayWidth,height:i.clip.overLayWidth});var e=new Image;e.src=t,e.onload=function(){APP.router.endLoading(),i.clip.originImgSizeObj.width=this.width,i.clip.originImgSizeObj.height=this.height,i.clip.$img.attr("src",t),a.getData(e,function(){imgExif=a.getAllTags(this);e.width,e.height;6==imgExif.Orientation&&e.height/e.width<1&&i.clip.$img.css({width:"100%",height:i.clip.originImgSizeObj.height/(i.clip.originImgSizeObj.width/i.clip.fullWidth)+"px"})})},e.onerror=function(){APP.router.endLoading(),APP.ui.showPrompt("图片渲染失败,请稍后重试!"),i.clip.$clipContainer.hide()}},_getRectWidth:function(t,i){return Math.min.call(null,t,i)},init:function(t){var i=this;i.isImgChange=!1,i.origin=t.pregnantStatus?t.pregnantStatus:null,i._getChildInfo(t)},_getChildInfo:function(i){var e=this;if(0==APP.profileInfo.childState)return void e.ready(i,{});localStorage.removeItem("babyInfoObj");var a={request_context:{customerId:APP.profileInfo.customerId,appType:APP.openType,uid:APP.uid},access_token:localStorage.getItem("token"),system:"mch"};t.ajax({url:APP.host.api+"/infanthospital/v1/getChildInfo",data:JSON.stringify(a),type:"post",contentType:"application/json",success:function(t){if(1==t.ret){var a=e._todoData(t.data);e.ready(i,a)}else APP.ui.showPrompt(t.msg)}})},_todoData:function(t){var i=this;if(t.dateBorn){var e=i._getSerializeDate(t.dateBorn);t.dateBornText=e[0]+"年"+e[1]+"月"+e[2]+"日"}return t.babyPictures&&(i.imgData=t.babyPictures),parseInt(t.weight)<10&&(t.weight=1e3*t.weight),t},destroy:function(){this.$rootDom.html(""),this.$rootDom.removeClass("page-declare-safety visibile"),t("body").find(".logobg").css("visibility","visible"),t("body").removeClass("bg-color-common")}}}.apply(i,a))&&(t.exports=o)},65:function(t,i){t.exports='<script id=declare_safety_template type=text/template> <form action="">\r\n        <div class="avatar-container">\r\n            <div class="container {{if babyPictures}}active{{/if}}">\r\n                <input type="file" class="upload-avatar" accept="image/*">\r\n                <div class="box">上传宝宝靓照</div>\r\n                <div class="wrap-pic">\r\n                    <img src="{{babyPictures}}" alt="" class="pic">\r\n                    <p>重新上传+</p>\r\n                </div>\r\n            </div>\r\n            <div class="desc">上传一张宝宝的照片,<br>去给叔叔阿姨们报平安</div>\r\n        </div>\r\n        <ul class="list">\r\n            <li class="item">\r\n                <span class="key">宝宝性别</span>\r\n                <span class="select-info">\r\n                    <select name="sex">\r\n                        <option {{if sex == "小公举"}} selected="selected" {{/if}} value="小公举">小公举</option>\r\n                        <option {{if sex == "小王子"}} selected="selected" {{/if}} value="小王子">小王子</option>\r\n                        <option {{if sex == "兄弟连"}} selected="selected" {{/if}} value="兄弟连">兄弟连</option>\r\n                        <option {{if sex == "姐妹花"}} selected="selected" {{/if}} value="姐妹花">姐妹花</option>\r\n                        <option {{if sex == "龙凤胎"}} selected="selected" {{/if}} value="龙凤胎">龙凤胎</option>\r\n                        <option {{if sex == "多胞胎"}} selected="selected" {{/if}} value="多胞胎">多胞胎</option>\r\n                    </select>\r\n                </span>\r\n            </li>\r\n            <li class="item">\r\n                <span class="key">宝宝出生日期</span>\r\n                <label for="select_birth_day" class="select-info child-val-label">{{dateBornText ? dateBornText : \'请填写日期\'}}</label>\r\n            </li>\r\n            <li class="item">\r\n                <span class="key">宝宝体重</span>\r\n                <span class="select-info">\r\n                    <input class="ipt" value="{{weight ? weight : 2500}}" type="number" name="weight" placeholder="请填写体重值">g\r\n                </span>\r\n\r\n            </li>\r\n        </ul>\r\n        <button class="gener-btn">立即生成</button>\r\n        <input id="select_birth_day" class="birth ipt" type="date" name="birth" value="{{dateBorn}}">\r\n    </form>\r\n    <div class="logo">\r\n        <img src="images/logo_white.png" class="img" alt="">\r\n    </div>\r\n    <div class="clip-image-container">\r\n        <img class="clip-img" />\r\n        <div class="overlay"></div>\r\n        <div class="tip">\r\n            <button class="btn ok">确定</button>\r\n            <button class="btn cancel">取消</button>\r\n        </div>\r\n    </div> <\/script>'}});